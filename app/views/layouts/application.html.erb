<!DOCTYPE html>
<html lang="en" class="h-full bg-white dark:bg-gray-950">
  <head>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= render "layouts/meta" %>

    <%# Three-way dark mode toggle â€” prevent FOUC %>
    <script>
      document.documentElement.classList.toggle(
        "dark",
        localStorage.theme === "dark" ||
          (!("theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)
      );
    </script>

    <%= stylesheet_link_tag :tailwind, "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag :application, "data-turbo-track": "reload" %>

    <script async src="https://ga.jspm.io/npm:es-module-shims@1.8.2/dist/es-module-shims.js" data-turbo-track="reload"></script>
    <%= javascript_importmap_tags %>

    <meta name="view-transition" content="same-origin">
    <%= yield(:head) %>
  </head>
  <body class="h-full bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100">
    <% if admin_impersonating? %>
      <div class="bg-yellow-100 dark:bg-yellow-900/30 border-b border-yellow-200 dark:border-yellow-800 px-4 py-2 text-center text-sm text-yellow-800 dark:text-yellow-200">
        Impersonating <strong><%= current_user.email %></strong>
        <%= link_to "Stop", stop_impersonating_path, data: { turbo_method: :post },
          class: "ml-2 font-semibold underline" %>
      </div>
    <% end %>

    <%= render "layouts/navigation" %>
    <%= render "layouts/messages" %>

    <div class="min-h-[75vh] mt-6">
      <%= yield(:naked) %>
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <%= yield %>
      </div>
    </div>

    <div class="mt-6">
      <%= render "layouts/footer" %>
    </div>

    <%= render "layouts/modal" %>
  </body>
</html>
